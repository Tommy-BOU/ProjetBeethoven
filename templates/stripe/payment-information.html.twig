{% extends 'base.html.twig' %}

{% block title %}User{% endblock %}

{% block body %}
<div class="container">
<br><br><br>
    <h2>Paiement pour l'abonnement {{ subscriptionType|capitalize }}</h2>
    <p>Montant à payer : {{ amount }} €</p>
    
    <form id="checkout-form" action="{{ path('create_charge') }}" method="post">

        <div id="card-element" class="mb-3">
        </div>

        <div id="card-errors" role="alert"></div>


        <div class="mb-3">
            <label for="cardholder-name" class="form-label">Nom du titulaire de la carte</label>
            <input type="text" id="cardholder-name" name="cardholder-name" class="form-control" placeholder="Nom sur la carte" required>
        </div>


        <div class="mb-3">
            <label for="billing-country" class="form-label">Pays ou région</label>
            <select id="billing-country" name="billing-country" class="form-select" required>
                <option value="FR">France</option>
            </select>
        </div>

        <input type='hidden' name='stripeToken' id='stripe-token-id'>
        <button type="submit" class="btn btn-success mt-3" onclick = "createToken()">Payer {{ amount }} €</button>
    </form>
</div>
    <script src="https://js.stripe.com/v3/" ></script>
    <script>
        var stripe = Stripe("{{stripe_key}}");
        var elements = stripe.elements();
        var cardElement = elements.create('card');
        cardElement.mount('#card-element');
     
        function createToken() {
            document.getElementById("pay-btn").disabled = true;
            stripe.createToken(cardElement).then(function(result) {
     
                     
                if(typeof result.error != 'undefined') {
                    document.getElementById("pay-btn").disabled = false;
                    alert(result.error.message);
                }
     
           
                if(typeof result.token != 'undefined') {
                    document.getElementById("stripe-token-id").value = result.token.id;
                    document.getElementById('checkout-form').submit();
                }
            });
        }
    </script>
    {% endblock %}